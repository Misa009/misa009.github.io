<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Notas</title>
  <style>
    :root{
      --bg:#000;
      --nav:#1c1c1e;
      --nav-2:#2c2c2e;
      --cell:#1c1c1e;
      --cell-hi:#2c2c2e;
      --cell-press:#3a3a3c;
      --line:#3a3a3c;
      --text:#fff;
      --muted:#a1a1a6;
      --muted-2:#8e8e93;
      --accent:#ffd60a;
      --danger:#ff453a;
      --blue:#0a84ff;
      --font:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:var(--font);-webkit-font-smoothing:antialiased;
      overflow:hidden;
    }
    .app{position:fixed;inset:0;display:flex;flex-direction:column;}
    .nav{
      height:48px;flex:0 0 auto;display:flex;align-items:center;gap:6px;
      padding:0 10px;background:rgba(28,28,30,.96);
      border-bottom:1px solid var(--line);backdrop-filter:saturate(180%) blur(18px);
      position:relative;z-index:20;
    }
    .nav .title{font-weight:700;font-size:20px;letter-spacing:.2px;color:var(--accent);margin:0 auto;pointer-events:none;}
    .nav .left,.nav .right{display:flex;align-items:center;gap:2px;min-width:72px;}
    .nav .right{justify-content:flex-end}
    .nav-btn{background:transparent;border:0;color:var(--accent);font-size:16px;font-weight:600;padding:6px 8px;border-radius:8px;cursor:pointer;}
    .nav-btn:active{background:#00000040}

    .main{position:relative;flex:1;min-height:0;background:var(--bg);overflow:hidden;}

    .screen{position:absolute;inset:0;display:flex;flex-direction:column;min-height:0;transition:transform .28s cubic-bezier(.2,.8,.2,1);}
    #foldersScreen{transform:translateX(0);z-index:5;background:var(--bg);}
    #notesScreen{transform:translateX(100%);z-index:1;background:var(--bg);}
    .show-notes #foldersScreen{transform:translateX(-100%);}
    .show-notes #notesScreen{transform:translateX(0);}

    .folders-list{padding:10px 10px 20px;overflow:auto;}
    .folder-cell{
      background:var(--cell);border-radius:12px;padding:12px 14px;margin-bottom:8px;
      display:flex;align-items:center;gap:10px;cursor:pointer;
    }
    .folder-icon{width:22px;height:18px;border-radius:4px;background:var(--accent);}
    .folder-name{font-size:16px;font-weight:700;}
    .folder-count{margin-left:auto;color:var(--muted-2);font-weight:700;font-size:13px;}

    .sidebar{
      position:absolute;top:0;bottom:0;left:0;width:min(86vw,340px);
      background:var(--bg);border-right:1px solid var(--line);
      display:flex;flex-direction:column;min-height:0;transform:translateX(-100%);
      transition:transform .28s cubic-bezier(.2,.8,.2,1);z-index:6;
    }
    .sidebar.open{transform:translateX(0);}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:5;}
    .overlay.show{opacity:1;pointer-events:auto;}

    .search-row{background:var(--nav);border-bottom:1px solid var(--line);padding:8px 10px;display:flex;flex-direction:column;gap:8px;}
    .folder-line{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);font-weight:700;}
    .folder-line .pill{margin-left:auto;font-weight:700;color:var(--muted-2);}
    .search{width:100%;background:var(--nav-2);border:1px solid transparent;color:var(--text);padding:9px 10px;font-size:15px;border-radius:10px;outline:none;}
    .search::placeholder{color:var(--muted-2)}
    .count{font-size:12px;color:var(--muted-2);font-weight:700;padding:0 2px;}

    .list{flex:1;min-height:0;overflow:auto;padding:8px 8px 90px;}
    .section-title{color:var(--muted);font-weight:800;font-size:12px;letter-spacing:.5px;text-transform:uppercase;padding:8px 6px;}
    .note-cell{background:var(--cell);border-radius:12px;padding:10px 12px;margin-bottom:6px;cursor:pointer;transition:background .12s ease,transform .02s ease;border:1px solid transparent;}
    .note-cell:hover{background:var(--cell-hi);}
    .note-cell:active{background:var(--cell-press);transform:translateY(1px);}
    .note-title{font-size:16px;font-weight:700;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px;}
    .note-meta{font-size:12px;color:var(--muted-2);font-weight:600;display:flex;gap:6px;align-items:center;}
    .note-preview{font-size:14px;color:#d1d1d6;margin-top:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    .editor{position:absolute;inset:0;display:flex;flex-direction:column;min-height:0;background:var(--bg);z-index:1;}
    .editor-top{background:var(--nav);border-bottom:1px solid var(--line);padding:6px 8px;display:flex;align-items:center;gap:8px;}
    .editor-top .date{font-size:12px;color:var(--muted);font-weight:800;background:var(--nav-2);padding:6px 8px;border-radius:8px;}
    .editor-top .actions{margin-left:auto;display:flex;gap:6px;}
    .icon-btn{width:34px;height:34px;border-radius:9px;background:var(--nav-2);border:0;color:var(--text);font-size:16px;cursor:pointer;display:grid;place-items:center;}
    .icon-btn:active{transform:translateY(1px);}
    .icon-btn.danger{color:var(--danger);background:#3a2020;}

    textarea{flex:1;min-height:0;width:100%;background:var(--bg);color:var(--text);border:0;outline:none;resize:none;font-family:var(--font);font-size:18px;line-height:1.55;padding:16px 14px 120px;caret-color:var(--accent);}
    textarea::placeholder{color:var(--muted-2)}

    .empty{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;color:var(--muted);text-align:center;padding:30px;}
    .empty .big{font-size:20px;font-weight:800;color:var(--text);opacity:.9;}

    .fab{position:absolute;right:18px;bottom:18px;width:56px;height:56px;border-radius:16px;background:var(--accent);color:#000;font-size:26px;font-weight:900;display:grid;place-items:center;border:0;cursor:pointer;box-shadow:0 14px 38px rgba(0,0,0,.6);z-index:2;}
    .fab:active{transform:translateY(1px);}

    @media (min-width:980px){
      body{overflow:auto;}
      .app{position:relative;height:100vh;}
      #foldersScreen{display:none;}
      #notesScreen{transform:none;position:relative;inset:auto;}
      .main{display:grid;grid-template-columns:360px 1fr;}
      .sidebar{position:relative;transform:none !important;width:auto;z-index:1;}
      .overlay{display:none;}
      .editor{position:relative;}
      .nav .title{margin-left:0;}
    }
  </style>
</head>
<body>
<div class="app" id="appRoot">
  <div class="nav">
    <div class="left">
      <button class="nav-btn" id="carpetasBtn">Carpetas</button>
    </div>
    <div class="title">Notas</div>
    <div class="right">
      <button class="nav-btn" id="moreBtn">‚Ä¢‚Ä¢‚Ä¢</button>
    </div>
  </div>

  <div class="main">
    <section class="screen" id="foldersScreen">
      <div class="folders-list">
        <div class="folder-cell" id="openNotesFolder">
          <div class="folder-icon"></div>
          <div class="folder-name">Notas</div>
          <div class="folder-count" id="folderCount">0</div>
        </div>
        <div class="folder-cell" style="opacity:.7">
          <div class="folder-icon" style="background:#888"></div>
          <div class="folder-name">En mi iPhone</div>
          <div class="folder-count">‚Äî</div>
        </div>
      </div>
    </section>

    <section class="screen" id="notesScreen">
      <aside class="sidebar" id="sidebar">
        <div class="search-row">
          <div class="folder-line">
            <span>iCloud</span>
            <span class="pill">Notas</span>
          </div>
          <input class="search" id="searchInput" placeholder="Buscar" />
          <div class="count" id="countLabel">0 notas</div>
        </div>
        <div class="list" id="list"></div>
      </aside>

      <div class="overlay" id="overlay"></div>

      <section class="editor" id="editor">
        <div class="editor-top" id="editorTop" style="display:none;">
          <div class="date" id="dateLabel"></div>
          <div class="actions">
            <button class="icon-btn" id="shareBtn" title="Compartir">‚§¥Ô∏é</button>
            <button class="icon-btn" id="checkBtn" title="Checklist">‚òëÔ∏é</button>
            <button class="icon-btn danger" id="delBtn" title="Eliminar">üóëÔ∏è</button>
          </div>
        </div>

        <div class="empty" id="emptyState">
          <div class="big">Sin nota seleccionada</div>
          <div>Abre el panel lateral para elegir una nota.</div>
        </div>

        <button class="fab" id="newFab" title="Nueva nota">‚úé</button>
      </section>
    </section>
  </div>
</div>

<script>
  const STORAGE_KEY = "notas_ios_dark_folders_v5";
  const seedNotes = [
    { body:`Marcas de coches\n- Mercedes-Benz\n- BMW\n- Audi\n- Volkswagen\n- Porsche\n- Ferrari\n- Lamborghini\n- Toyota\n- Honda\n- Hyundai\n- Kia\n- Renault\n- Peugeot\n- SEAT\n- Tesla\n- BYD\n- Volvo\n- Ford\n- Chevrolet\n- Lexus`, ts:1763982899824 },
    { body:`Canciones para rutinas\n- Billie Jean ‚Äî Michael Jackson\n- Bohemian Rhapsody ‚Äî Queen\n- Blinding Lights ‚Äî The Weeknd\n- Viva la Vida ‚Äî Coldplay\n- Shape of You ‚Äî Ed Sheeran\n- Hysteria ‚Äî Muse\n- Lose Yourself ‚Äî Eminem\n- Titanium ‚Äî David Guetta ft. Sia\n- La Flaca ‚Äî Jarabe de Palo\n- Mi Gran Noche ‚Äî Raphael`, ts:1763896499824 },
    { body:`Pa√≠ses por continentes\nEuropa:\n- Espa√±a, Francia, Italia, Alemania, Portugal, Reino Unido\n\nAm√©rica:\n- Canad√°, Estados Unidos, M√©xico, Colombia, Argentina, Chile, Brasil\n\nAsia:\n- Jap√≥n, China, Corea del Sur, India\n\n√Åfrica:\n- Marruecos, Egipto, Senegal, Nigeria\n\nOcean√≠a:\n- Australia, Nueva Zelanda`, ts:1763810099824 },
    { body:`Trucos (ideas r√°pidas)\n- Predicci√≥n en notas\n- Forzaje de canci√≥n\n- Doble realidad con NFC\n- Final con revelaci√≥n en iPhone`, ts:1763723699824 },
    { body:`Checklist de show\n- [ ] Preparar baraja\n- [ ] Cargar NFC\n- [ ] Ensayar rutina\n- [x] Revisar m√∫sica`, ts:1763550899824 },
    { body:`Marcas japonesas\n- Toyota\n- Honda\n- Nissan\n- Mazda\n- Subaru\n- Lexus\n- Infiniti`, ts:1763464499824 },
    { body:`Ciudades para viajar\n- Tokio\n- Nueva York\n- Roma\n- Londres\n- Lisboa\n- Estambul\n- Marrakech`, ts:1752580800000 },
    { body:`Pel√≠culas pendientes\n- Ahora me ves 3\n- Dune 2\n- Oppenheimer\n- Interstellar (re)`, ts:1752321600000 },
    { body:`Coches que quiero mirar\n- CLA 45 2013\n- CLA 250 2013\n- BMW 420i 2017\n- C220d 2016`, ts:1748973600000 }
  ];

  let notes = [];
  let activeId = null;

  const appRoot = document.getElementById("appRoot");
  const carpetasBtn = document.getElementById("carpetasBtn");
  const openNotesFolder = document.getElementById("openNotesFolder");
  const folderCount = document.getElementById("folderCount");
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const listEl = document.getElementById("list");
  const editorEl = document.getElementById("editor");
  const editorTopEl = document.getElementById("editorTop");
  const emptyStateEl = document.getElementById("emptyState");
  const dateLabel = document.getElementById("dateLabel");
  const searchInput = document.getElementById("searchInput");
  const countLabel = document.getElementById("countLabel");
  const newFab = document.getElementById("newFab");
  const moreBtn = document.getElementById("moreBtn");
  const shareBtn = document.getElementById("shareBtn");
  const delBtn = document.getElementById("delBtn");
  const checkBtn = document.getElementById("checkBtn");

  function isDesktop(){ return window.matchMedia("(min-width: 980px)").matches; }
  function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }
  function nowTs(){ return Date.now(); }

  function firstLine(text){
    const l = (text || "").split("\n").map(s=>s.trim()).find(Boolean);
    return l || "Sin t√≠tulo";
  }
  function preview(text){
    const lines = (text || "").split("\n").map(s=>s.trim()).filter(Boolean);
    if(lines.length <= 1) return (lines[0] || "");
    return lines.slice(1).join(" ").slice(0, 90);
  }
  function fmtDate(ts){
    const d = new Date(ts);
    return d.toLocaleDateString("es-ES",{ day:"2-digit", month:"short", year:"numeric" });
  }
  function sortNotes(arr){ return arr.slice().sort((a,b)=> b.updatedAt - a.updatedAt); }

  function groupLabel(ts){
    const diff = nowTs() - ts;
    const seven = 7*24*60*60*1000;
    if(diff <= seven) return "√öLTIMOS 7 D√çAS";
    const d = new Date(ts);
    return d.toLocaleDateString("es-ES",{ month:"long", year:"numeric" }).toUpperCase();
  }

  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){
      notes = seedNotes.map(n=>({
        id: uid(),
        body: n.body,
        createdAt: n.ts,
        updatedAt: n.ts
      }));
      save(); return;
    }
    try{ notes = JSON.parse(raw) || []; }catch(e){ notes = []; }
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(notes)); }

  function renderList(){
    const q = searchInput.value.trim().toLowerCase();
    const filtered = sortNotes(notes).filter(n => (n.body||"").toLowerCase().includes(q));
    listEl.innerHTML = "";

    let lastGroup = null;
    filtered.forEach(n=>{
      const g = groupLabel(n.updatedAt);
      if(g !== lastGroup){
        const h = document.createElement("div");
        h.className = "section-title";
        h.textContent = g;
        listEl.appendChild(h);
        lastGroup = g;
      }

      const cell = document.createElement("div");
      cell.className = "note-cell";
      cell.onclick = ()=>openNote(n.id);
      cell.innerHTML = `
        <div class="note-title">${firstLine(n.body)}</div>
        <div class="note-meta">
          <span>${fmtDate(n.updatedAt)}</span><span>‚Ä¢</span>
          <span>${(n.body||"").length} caracteres</span>
        </div>
        <div class="note-preview">${preview(n.body)}</div>
      `;
      listEl.appendChild(cell);
    });

    countLabel.textContent = `${filtered.length} nota${filtered.length!==1?"s":""}`;
    folderCount.textContent = notes.length;
  }

  function clearEditor(){
    const oldTa = editorEl.querySelector("textarea");
    if(oldTa) oldTa.remove();
  }

  function renderEditor(){
    clearEditor();
    const note = notes.find(n=>n.id===activeId);
    if(!note){
      editorTopEl.style.display="none";
      emptyStateEl.style.display="flex";
      return;
    }
    emptyStateEl.style.display="none";
    editorTopEl.style.display="flex";
    dateLabel.textContent = fmtDate(note.updatedAt);

    const ta = document.createElement("textarea");
    ta.placeholder = "Escribe tu nota‚Ä¶";
    ta.value = note.body || "";
    ta.oninput = ()=>{
      note.body = ta.value;
      note.updatedAt = nowTs();
      save();
      renderList();
      dateLabel.textContent = fmtDate(note.updatedAt);
    };
    editorEl.insertBefore(ta, newFab);
    setTimeout(()=>ta.focus(),0);

    shareBtn.onclick = ()=>{
      navigator.clipboard?.writeText(note.body||"");
      alert("Nota copiada al portapapeles.");
    };
    delBtn.onclick = deleteActive;
    checkBtn.onclick = ()=>toggleChecklistLine(ta);
  }

  function createNote(){
    const n={ id:uid(), body:"", createdAt:nowTs(), updatedAt:nowTs() };
    notes.push(n); save();
    activeId=n.id;
    renderList();
    renderEditor();
    if(!isDesktop()) closeSidebar();
  }

  function deleteActive(){
    if(!activeId) return;
    const note = notes.find(n=>n.id===activeId);
    const title = firstLine(note?.body||"");
    if(!confirm(`¬øEliminar esta nota?\n\n"${title}"`)) return;
    notes = notes.filter(n=>n.id!==activeId);
    activeId = notes[0]?.id || null;
    save(); renderList(); renderEditor();
  }

  function openNote(id){
    activeId=id;
    renderEditor();
    if(!isDesktop()) closeSidebar();
  }

  function openSidebar(){ sidebar.classList.add("open"); overlay.classList.add("show"); }
  function closeSidebar(){ sidebar.classList.remove("open"); overlay.classList.remove("show"); }

  overlay.onclick = closeSidebar;

  function showFolders(){
    if(isDesktop()) { openSidebar(); return; }
    document.getElementById("appRoot").classList.remove("show-notes");
    closeSidebar();
    activeId = null;
    renderEditor();
  }
  function showNotes(){
    if(isDesktop()) { openSidebar(); return; }
    document.getElementById("appRoot").classList.add("show-notes");
    openSidebar();
  }

  carpetasBtn.onclick = showFolders;
  openNotesFolder.onclick = showNotes;

  function exportNotes(){
    const data = sortNotes(notes).map(n=>({
      title:firstLine(n.body),
      body:n.body,
      updatedAt:new Date(n.updatedAt).toISOString()
    }));
    const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url; a.download="notas-export.json"; a.click();
    URL.revokeObjectURL(url);
  }
  moreBtn.onclick = exportNotes;

  function toggleChecklistLine(ta){
    const start = ta.selectionStart;
    const text = ta.value;
    const lineStart = text.lastIndexOf("\n", start-1)+1;
    const lineEnd = text.indexOf("\n", start);
    const le = lineEnd===-1? text.length : lineEnd;
    const line = text.slice(lineStart, le);

    let newLine;
    if(line.trim().startsWith("- [ ]")){
      newLine = line.replace("- [ ]","- [x]");
    } else if(line.trim().startsWith("- [x]")){
      newLine = line.replace("- [x]","- [ ]");
    } else {
      newLine = "- [ ] " + line;
    }

    ta.value = text.slice(0,lineStart) + newLine + text.slice(le);
    const cursor = lineStart + newLine.length;
    ta.setSelectionRange(cursor,cursor);
    ta.dispatchEvent(new Event("input"));
  }

  // Init
  load();
  renderList();
  renderEditor();
  if(!isDesktop()){
    document.getElementById("appRoot").classList.remove("show-notes"); // start in folders
  } else {
    document.getElementById("appRoot").classList.add("show-notes");
    openSidebar();
  }

  newFab.onclick = createNote;
  searchInput.oninput = renderList;
  window.addEventListener("resize", ()=>{
    if(isDesktop()){
      document.getElementById("appRoot").classList.add("show-notes");
      closeSidebar();
    }
  });
</script>
</body>
</html>
